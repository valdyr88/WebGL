<!DOCTYPE html>
<html lang="en-US" dir="ltr" class="redesign no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Chrome">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="index, follow">
  <!-- common social tags -->
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://developer.mozilla.org/media/img/opengraph-logo.png">
  <meta property="og:site_name" content="Mozilla Developer Network">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://developer.mozilla.org/media/img/opengraph-logo.png">
  <meta name="twitter:site" content="@NewOnMDN">
  <meta name="twitter:creator" content="@NewOnMDN">
  
  <script id="functions" src="./../../Shaders/include/functions.glsl" type="shader/fragment"></script>
  <script id="structs" src="./../../Shaders/include/structs.glsl" type="shader/fragment"></script>
  <script id="pbr" src="./../../Shaders/include/pbr.glsl" type="shader/fragment"></script>
  <script id="defines" src="./../../Shaders/include/defines.glsl" type="shader/fragment"></script>
  
  <script id="ubCamera" src="./../../Shaders/include/uniformBuffers/ubCamera.glsl" type="shader/fragment"></script>
  <script id="ubLight" src="./../../Shaders/include/uniformBuffers/ubLight.glsl" type="shader/fragment"></script>
  <script id="ubMaterial" src="./../../Shaders/include/uniformBuffers/ubMaterial.glsl" type="shader/fragment"></script>
  <script id="ubModel" src="./../../Shaders/include/uniformBuffers/ubModel.glsl" type="shader/fragment"></script>
  
  <script id="simpleVS" src="./../../Shaders/simple.vs.glsl" type="shader/vertex"></script>
  <script id="viewquadVS" src="./../../Shaders/viewquad.vs.glsl" type="shader/vertex"></script>
  <script id="simpleFS" src="./../../Shaders/simple.fs.glsl" type="shader/fragment"></script>
  <script id="pbr_shader" src="./../../Shaders/pbr_shader.fs.glsl" type="shader/fragment"></script>
  <script id="skybox_shader" src="./../../Shaders/skybox.fs.glsl" type="shader/fragment"></script>
  <script id="backbuffer_shader" src="./../../Shaders/backbuffer.fs.glsl" type="shader/fragment"></script>
  <script id="deferred_opaque_shader" src="./../../Shaders/deferred_opaque_shader.fs.glsl" type="shader/fragment"></script>
  <script id="glow_integrate_shader" src="./../../Shaders/glow_integrate_shader.fs.glsl" type="shader/fragment"></script>
  <script id="deferred_BcNAoRSMt" src="./../../Shaders/deferred_BcNAoRSMt.fs.glsl" type="shader/fragment"></script>
  <script id="deferred_planet_BcNAoRSMt" src="./../../Shaders/Space/deferred_planet_BcNAoRSMt.fs.glsl" type="shader/fragment"></script>
  <script id="deferred_skybox" src="./../../Shaders/deferred_skybox.fs.glsl" type="shader/fragment"></script>
  <script id="transparent_shader" src="./../../Shaders/cloak_transparent_shader.fs.glsl" type="shader/fragment"></script>
  <script id="atmosphere_shader" src="./../../Shaders/Space/planet_atmosphere.fs.glsl" type="shader/fragment"></script>
  <script id="volumetric_fog_shadows_shader" src="./../../Shaders/volumetric_fog_shadows_shader.fs.glsl" type="shader/fragment"></script>
  
  <script id="mipmapVS" src="./../../Shaders/mipmapgen.vs.glsl" type="shader/vertex"></script>
  <script id="3x3MipGenFS" src="./../../Shaders/3x3MipGen.fs.glsl" type="shader/fragment"></script>
  
  <!-- <script id="navigatorModel" src="./../../Models/Rock_6.OBJ" type="model/obj"></script> -->
  <!--<script id="navigatorModel" src="./../../Models/quadNT.obj" type="model/obj"></script>-->
  <script id="SphereModel" src="./../../Models/Sphere.obj" type="model/obj"></script>
  <script id="navigatorModel" src="./../../Models/navigatorModel2.obj" type="model/obj"></script>
  <script id="bigModel" src="./Models/Planets/Icosphere7.obj" type="model/obj"></script>
  
  <!-- <img id="txRock_D" src="./../../Models/Rock_6_D.png" type="tx2D/D" style="display: none;"></img>
  <img id="txRock_AoRS" src="./../../Models/Rock_6_AoRS.png" type="tx2D/AoRS" style="display: none;"></img>
  <img id="txRock_N" src="./../../Models/Rock_6_N.png" type="tx2D/N" style="display: none;"></img> -->
  
  <img id="txRock_D" src="./../../Textures/null/white.png" type="tx2D/D" style="display: none;"></img>
  <img id="txRock_AoRS" src="./../../Textures/null/white.png" type="tx2D/AoRS" style="display: none;"></img>
  <img id="txRock_N" src="./../../Textures/null/white.png" type="tx2D/N" style="display: none;"></img>
    
  <!-- <img id="txRock_D" src="./../../Models/gerasy_metal_pan_Bc.png" type="tx2D/D" style="display: none;"></img> -->
  <!-- <img id="txRock_AoRS" src="./../../Models/gerasy_metal_pan_AoRMt.png" type="tx2D/AoRMt" style="display: none;"></img> -->
  <!-- <img id="txRock_N" src="./../../Models/gerasy_metal_pan_N.png" type="tx2D/N" style="display: none;"></img> -->
  
  <!-- <img id="txRock_D" src="./../../Models/iron-rusted4-Bc.png" type="tx2D/D" style="display: none;"></img> -->
  <!-- <img id="txRock_AoRS" src="./../../Models/iron-rusted4-AoRMt.png" type="tx2D/AoRMt" style="display: none;"></img> -->
  <!-- <img id="txRock_N" src="./../../Models/iron-rusted4-N.png" type="tx2D/N" style="display: none;"></img> -->
  
  <!-- <img id="txRock_D" src="./../../Models/Titanium-Scuffed-Bc.png" type="tx2D/D" style="display: none;"></img>
  <img id="txRock_AoRS" src="./../../Models/Titanium-Scuffed-AoRMt.png" type="tx2D/AoRMt" style="display: none;"></img>
  <img id="txRock_N" src="./../../Models/Titanium-Scuffed-N.png" type="tx2D/N" style="display: none;"></img> -->
    
  
  <img id="txGlass_AoRS" src="./../../Models/glass_AoRS.png" type="tx2D/AoRS" style="display: none;"></img>
  <img id="txGlass_N" src="./../../Models/glass_N.png" type="tx2D/N" style="display: none;"></img>
  
  <img id="txAtmosphere" src="./../../Models/atmosphere.png" type="tx2D/D" style="display: none;"></img>
  <!-- <img id="txcAmbient_xp" src="./../../Textures/Ambients/Ambient01_xp.png" -->
					   <!-- srcset="./../../Textures/Ambients/Ambient01_xp.png" -->
										<!-- style="display: none"></img> -->
										
  <!--<img id="tx128" src="./../../Textures/128.png"></img>-->
  <img id="tx128" src="./../../Textures/venice.hdr" style="display: none" type="txC/Amb:128/hdr"></img>
  <!-- <img id="txAmbHDRVenice" src="./../../Textures/Cubemaps/Ambients/Venice/venice_hdr.zip" style="display: none" type="txC/Amb:128/hdr"></img> -->
  <!-- <img id="txAmbHDRVenice" src="./../../Textures/Cubemaps/Ambients/Forest/epping_forest_hdr.zip" style="display: none" type="txC/Amb:128/hdr"></img> -->
  <!-- <img id="txAmbHDRVenice" src="./../../Textures/Cubemaps/Ambients/ForestC/forest_c_hdr.zip" style="display: none" type="txC/Amb:512/hdr"></img> -->
  <img id="txAmbHDRVenice" src="./../../Textures/Cubemaps/Ambients/Space/Turqoise/space_turqoise.zip" style="display: none" type="txC/Amb:512/hdr"></img>
  
  <img id="txBRDF_LUT" src="./../../Textures/BRDF_LUT.png" style="display: none" type="tx2D/LUT"></img>
  
  <script id="sovereignAsb" src="./Models/Ships/Sovereign/ship.xml" style="display: none" type="text/xml"></script>
  <script id="galaxyAsb" src="./Models/Ships/Galaxy/ship.xml" style="display: none" type="text/xml"></script>
  <script id="dderidexAsb" src="./Models/Ships/DDeridex/ship.xml" style="display: none" type="text/xml"></script>
  
  <script id="planet" src="./Models/Planets/ClassM/planet.xml" style="display: none" type="text/xml"></script>
  
  <script src="./../../GLExt/GLExt.js" type="module" ></script>
  <!-- <script src="./main.js" type="script"></script> -->
  
  </head>
<body>
	<!-- Debug reloads -->
	<!-- <img id="reload_shader_btn" onclick="reload_shader('deferred_opaque_shader')" title="deferred_opaque_shader" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('pbr')" title="pbr" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('deferred_BcNAoRSMt')" title="deferred_BcNAoRSMt" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('deferred_planet_BcNAoRSMt')" title="deferred_planet_BcNAoRSMt" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('volumetric_fog_shadows_shader')" title="volumetric_fog_shadows_shader" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('transparent_shader')" title="transparent_shader" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('glow_integrate_shader')" title="glow_integrate_shader" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('deferred_skybox')" title="deferred_skybox" src="./../../misc/reload_ico.png"></img>
	<img id="reload_shader_btn" onclick="reload_shader('atmosphere_shader')" title="atmosphere_shader" src="./../../misc/reload_ico.png"></img>
  	<img id="reload_texture_btn" onclick="reload_texture('planet_AoRS')" title="planet_AoRS" src="./../../misc/reload_ico.png"></img>
  	<img id="reload_texture_btn" onclick="reload_texture('planet_diffuse')" title="planet_diffuse" src="./../../misc/reload_ico.png"></img> -->
  
	<div style="background-color:#0055ff">
	  <canvas id="glcanvas" width="1920" height="1080">
		Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
	  </canvas>
	</div>
	
  <script type="module">
	import { main, recompileShader, reloadTexture, constructTextureDOMobj } from "./main_deffered.js";
	import { fetchImage } from "./../../GLExt/glTexture.js";
	function wait(ms){ const start = performance.now(); while(performance.now() - start < ms); }
	
	var extern_files_list = [
		"functions", "structs", "pbr", "defines", "ubCamera", "ubLight",
		"ubMaterial", "ubModel","simpleVS", "simpleFS", "pbr_shader", "skybox_shader",
		"backbuffer_shader", "SphereModel", "deferred_opaque_shader", "deferred_BcNAoRSMt", "volumetric_fog_shadows_shader", "viewquadVS", "deferred_planet_BcNAoRSMt",
		"deferred_skybox", "transparent_shader", "atmosphere_shader", "navigatorModel", "mipmapVS", "planet",
		"3x3MipGenFS", "tx128", "txAmbHDRVenice", "sovereignAsb", "galaxyAsb", "glow_integrate_shader", "dderidexAsb", "bigModel"
	];
	var extern_files_loaded_number = 0;
	
	//function recompileShader(fragment_name)
	
	function onExternFileLoadFinish(){
		++extern_files_loaded_number;
		if(extern_files_loaded_number >= extern_files_list.length){
			main();
		}
	}
	
	function fetchDefaultFile(obj, onLoadFinish){
		fetch(obj.src).then(
			function(response){
				response.text().then(
					function(text){
						obj.text = text;
						onLoadFinish();
					}
				);
			}
		);
	}
	
	function extractTypeFromOuterHTML(obj){
		var strArray = obj.outerHTML.split("type");
		if(strArray.length < 2) return false;
		var strTypeArray = strArray[1].split("\"");
		if(strTypeArray.length < 2) return false;
		obj.type = strTypeArray[1]; return true;		
	}
	
	function fetchAndStore(id){
		var obj = document.getElementById(id);
		if(obj == null) alert("fetchAndStore() obj == null, id == " + id);
		if(typeof obj.type === 'undefined' || obj.type == null)
			extractTypeFromOuterHTML(obj);
		
		switch(obj.tagName){
			default: fetchDefaultFile(obj, onExternFileLoadFinish); break;
			case "IMG": fetchImage(obj, onExternFileLoadFinish); break;
		}
	}
	
	function loadAllExternFiles(){
		extern_files_loaded_number = 0;
		for(var i = 0; i < extern_files_list.length; ++i){
			fetchAndStore(extern_files_list[i]);
		}
	}
	
	window.onload = function(){
		loadAllExternFiles();
	}
	
	function delayedMain(){
		if(extern_files_loaded_number >= extern_files_list.length){
			main(); }
		else{
			setTimeout(delayedMain,1000); }
	}
	
	window.reload_shader = function reload_shader(id){
		var obj = document.getElementById(id);
		if(obj == null) alert("fetchAndStore() obj == null, id == " + id);
		if(typeof obj.type === 'undefined' || obj.type == null)
			extractTypeFromOuterHTML(obj);
		
		var header = new Headers();
		header.append('pragma', 'no-cache');
		header.append('cache-control', 'no-cache');
		
		var init = { method: 'GET', headers: header, };
		
		fetch(obj.src, init).then(
			function(response){
				response.text().then(
					function(text){
						obj.text = text;
						recompileShader(id);
					}
				);
			}
		);
	}
	
	window.reload_texture = function reload_texture(id){
		var obj = document.getElementById(id);
		if(obj == null)
			obj = constructTextureDOMobj(id);
		
		var header = new Headers();
		header.append('pragma', 'no-cache');
		header.append('cache-control', 'no-cache');
		
		var init = { method: 'GET', headers: header, };
		
		/*fetch(obj.src, init).then(
			function(response){
				response.arrayBuffer().then(
					function(buffer){
						
						//BufferedImage img = ImageIO.read(new File(obj.src));
						//ImageIO.write(img, "png", buffer);
						
						var new_image = new Image(buffer);
						new_image.id = obj.id;
						new_image.src = obj.src;						
						obj.parentNode.insertBefore(new_image,obj);
						obj.parentNode.removeChild(obj);
						
						var arrayBufferView = new Uint8Array(buffer);
						var data = "data:image/png;base64,"+btoa(arrayBufferView);
						obj.src = data;
						
						reloadTexture(id);
					}
				);
			}
		);*/
		
		obj.onload = function(){ reloadTexture(id); }
		var str = obj.src.split('?reload=')[0];
		obj.src = str + "?reload=" + new Date().getTime();
	}
	
  </script>
  
  <textarea id="debug_text" style="display: none"> </textarea>
  
</body>